- name: Install Tomcat
  yum: name=tomcat state=present

- name: Configure Tomcat server
  template: src=server.xml dest=/usr/share/tomcat/conf/
  notify: restart tomcat

- name: Configure Tomcat users
  template: src=tomcat-users.xml dest=/usr/share/tomcat/conf/
  notify: restart tomcat

- name: Modify etc environment
  lineinfile:  dest="/etc/environment"  line='{{item}}'
  with_items:
  - 'CATALINA_HOME="/usr/share/tomcat"'

- name: Set Tomcat extra_path
  set_fact: mvn_extra_path="/usr/share/tomcat/bin"

- name: Add {{mvn_extra_path}} to path
  lineinfile: dest=/etc/environment state=present backrefs=yes regexp='PATH=(["]*)((?!.*?{{mvn_extra_path}}).*?)(["]*)$' line="PATH=\1\2:{{mvn_extra_path}}\3"

- name: Start Tomcat
  service: name=tomcat state=started enabled=yes

- name: Wait for tomcat to start
  wait_for: port={{http_port}}

