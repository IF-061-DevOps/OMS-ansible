- name: Install Tomcat
  yum: name=tomcat  state=present
  yum: name=tomcat-webapps  state=present
  yum: name=tomcat-admin-webapps  state=present

- name: Configure Tomcat server
  template: src=server.xml dest=/usr/share/tomcat/conf/
  notify: restart tomcat

- name: Configure Tomcat users
  template: src=tomcat-users.xml dest=/usr/share/tomcat/conf/
  notify: restart tomcat

- name: Configure Tomcat
  template: src=tomcat7 dest=/etc/default/tomcat7
  notify: restart tomcat

- name: Modify etc environment
  lineinfile:  dest="/etc/environment"  line='{{item}}'
  with_items:
  - 'CATALINA_HOME="/usr/share/tomcat"'

- name: Set Tomcat extra_path
  set_fact: extra_path="/usr/share/tomcat/bin"

- name: Add {{extra_path}} to path
  lineinfile: dest=/etc/environment state=present backrefs=yes regexp='PATH=(["]*)((?!.*?{{extra_path}}).*?)(["]*)$' line="PATH=\1\2:{{extra_path}}\3"

- name: Start Tomcat
  service: name=tomcat state=started enabled=yes

- name: Wait for tomcat to start
  wait_for: port={{http_port}}

